<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Puffly | The Sovereign App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff8fa3; --primary-grad: linear-gradient(135deg, #ffb3c1, #ff758f);
            --bg: #fff0f3; --card: #ffffff; --text: #4a2c32; --muted: #a38a8e;
            --accent: #ff4d6d; --bubble-me: #ffb3c1; --bubble-you: #ffe5ec;
            --nav-bg: rgba(255, 255, 255, 0.95);
            --puffly-blue: #87ceeb;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* --- 1. Splash Screen --- */
        #splash { position: fixed; inset: 0; background: var(--primary-grad); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; transition: 0.8s; }
        .splash-logo { font-size: 60px; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        /* --- 2. Global UI --- */
        .view-section { flex: 1; display: none; overflow-y: auto; padding-bottom: 80px; }
        .active-view { display: block; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 75px; background: var(--nav-bg); backdrop-filter: blur(15px); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid rgba(0,0,0,0.05); z-index: 4000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 5px; color: var(--muted); cursor: pointer; font-size: 11px; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 24px; }

        /* --- 3. Home View (Reels) --- */
        #homeView { background: #000; overflow: hidden; }
        .reel-video { position: relative; width: 100%; height: 100vh; display: flex; align-items: center; justify-content: center; color: white; }
        .reel-overlay { position: absolute; bottom: 100px; left: 15px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .reel-actions { position: absolute; bottom: 120px; right: 15px; display: flex; flex-direction: column; gap: 20px; align-items: center; }
        .action-btn { cursor: pointer; text-align: center; }
        .action-btn i { font-size: 32px; transition: 0.3s; }
        .action-btn.liked i { color: var(--puffly-blue); filter: drop-shadow(0 0 8px var(--puffly-blue)); }

        /* --- 4. Chat View --- */
        .chat-header { padding: 15px; background: white; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 100; }
        .chat-container { padding: 15px; display: flex; flex-direction: column; gap: 12px; height: calc(100vh - 215px); overflow-y: auto; background: var(--bg); }
        .bubble { max-width: 80%; padding: 10px 15px; border-radius: 18px; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .bubble.me { align-self: flex-end; background: var(--primary-grad); color: white; border-bottom-right-radius: 4px; }
        .bubble.you { align-self: flex-start; background: var(--card); border-bottom-left-radius: 4px; border: 1px solid rgba(0,0,0,0.05); }

        /* --- 5. Profile & Wallet --- */
        .profile-header { text-align: center; padding: 30px 20px; background: white; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; }
        .profile-pic { width: 90px; height: 90px; border-radius: 30px; background: var(--primary-grad); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 40px; }
        .wallet-card { margin: -20px 20px 20px; background: var(--primary-grad); border-radius: 20px; padding: 20px; color: white; box-shadow: 0 10px 25px rgba(255,143,163,0.3); }
        .admin-secret-link { text-decoration: none; color: rgba(0,0,0,0.01); font-size: 10px; }

        /* --- 6. Live Overlay --- */
        #liveOverlay { display: none; position: fixed; inset: 0; background: #000; z-index: 5000; flex-direction: column; }
        .live-chat { flex: 1; padding: 20px; display: flex; flex-direction: column; justify-content: flex-end; gap: 10px; color: white; overflow-y: auto; }
        .gift-panel { position: absolute; bottom: -100%; left: 0; right: 0; background: white; border-top-left-radius: 25px; border-top-right-radius: 25px; padding: 20px; transition: 0.4s; z-index: 5001; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .gift-panel.active { bottom: 0; }
    </style>
</head>
<body>

    <div id="splash">
        <i class="fa-solid fa-cloud splash-logo"></i>
        <h1 style="letter-spacing: 5px; margin-top: 15px;">PUFFLY</h1>
    </div>

    <div id="homeView" class="view-section active-view">
        <div class="reel-video">
            <div class="reel-overlay">
                <h3>@Puffly_Official</h3>
                <p>‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡πÇ‡∏•‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚òÅÔ∏è‚ú®</p>
            </div>
            <div class="reel-actions">
                <div class="action-btn" onclick="openLive()"><i class="fa-solid fa-tower-broadcast" style="color:red;"></i><p style="font-size:10px;">Live</p></div>
                <div class="action-btn" id="likeBtn" onclick="toggleLike()"><i class="fa-solid fa-cloud"></i><p style="font-size:10px;" id="likeCount">0</p></div>
                <div class="action-btn"><i class="fa-solid fa-comment-dots"></i><p style="font-size:10px;">24</p></div>
                <div class="action-btn"><i class="fa-solid fa-share"></i><p style="font-size:10px;">‡πÅ‡∏ä‡∏£‡πå</p></div>
            </div>
        </div>
    </div>

    <div id="inboxView" class="view-section">
        <div class="chat-header">
            <div style="width:40px; height:40px; border-radius:12px; background:var(--primary-grad); display:flex; align-items:center; justify-content:center; color:white;"><i class="fa-solid fa-cloud"></i></div>
            <div style="flex:1;"><b>‡∏ù‡πà‡∏≤‡∏¢‡∏î‡∏π‡πÅ‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ Puffly</b><p style="font-size:10px; color:green;">Online</p></div>
            <div style="display: flex; gap: 15px;">
                <i class="fa-solid fa-phone" style="color:var(--primary); cursor:pointer;" onclick="alert('Calling...')"></i>
                <i class="fa-solid fa-video" style="color:var(--primary); cursor:pointer;" onclick="alert('Video Calling...')"></i>
            </div>
        </div>
        <div id="chatBox" class="chat-container">
            <div class="bubble you">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ Puffly ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞ ‚òÅÔ∏è</div>
        </div>
        <div style="padding:15px; background:white; border-top:1px solid #eee;">
            <div style="display:flex; gap:10px; background:#f8f8f8; padding:10px 15px; border-radius:25px; align-items:center;">
                <input type="text" id="msgInput" style="flex:1; background:none; border:none; outline:none;" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
                <i class="fa-solid fa-paper-plane" style="color:var(--primary);" onclick="sendMsg()"></i>
            </div>
        </div>
    </div>

    <div id="profileView" class="view-section">
        <div class="profile-header">
            <div class="profile-pic"><i class="fa-solid fa-user"></i></div>
            <h2>@Creator_Asura</h2>
            <p style="color:var(--muted); font-size:12px;">‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á Asura's Ransom</p>
            <a href="admin.html" class="admin-secret-link">.</a>
        </div>
        <div class="wallet-card">
            <p style="font-size:12px; opacity:0.8;">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (Coins)</p>
            <h1 id="userCoins">...</h1>
            <div style="margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                <span>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ‡∏ø<span id="userIncome">0.00</span></span>
                <button onclick="withdrawMoney()" style="background:white; color:var(--primary); border:none; padding:8px 15px; border-radius:12px; font-weight:bold; font-size:12px;">‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
        </div>
    </div>

    <div id="liveOverlay">
        <div style="padding:20px; display:flex; justify-content:space-between; color:white; align-items:center;">
            <div style="background:red; padding:3px 10px; border-radius:5px; font-weight:bold; font-size:12px;">LIVE</div>
            <i class="fa-solid fa-xmark" onclick="closeLive()" style="font-size:25px;"></i>
        </div>
        <div id="liveComments" class="live-chat"></div>
        <div style="padding:15px; display:flex; gap:15px; background:rgba(0,0,0,0.5); align-items:center;">
            <input type="text" id="liveInp" style="flex:1; background:rgba(255,255,255,0.2); border:none; padding:12px; border-radius:25px; color:white;" placeholder="‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢...">
            <i class="fa-solid fa-gift" style="color:#ffd700; font-size:30px;" onclick="toggleGiftPanel(event)"></i>
        </div>
        <div id="giftPanel" class="gift-panel">
            <div style="text-align:center;" onclick="sendGift('üç≠', 10, 2)"><span>üç≠</span><p>10 C</p></div>
            <div style="text-align:center;" onclick="sendGift('‚òÅÔ∏è', 50, 10)"><span>‚òÅÔ∏è</span><p>50 C</p></div>
            <div style="text-align:center;" onclick="sendGift('üëë', 500, 100)"><span>üëë</span><p>500 C</p></div>
            <div style="text-align:center;" onclick="sendGift('üïäÔ∏è', 1000, 200)"><span>üïäÔ∏è</span><p>1K C</p></div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('homeView', this)"><i class="fa-solid fa-house"></i><span>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span></div>
        <div class="nav-item" onclick="switchTab('inboxView', this)"><i class="fa-solid fa-comment-dots"></i><span>‡πÅ‡∏ä‡∏ó</span></div>
        <div class="nav-item" onclick="switchTab('profileView', this)"><i class="fa-solid fa-user"></i><span>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span></div>
    </nav>

    <script type="module">
        // --- 1. Firebase Setup ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAT48SVlLZGo_XEYmf_K4MD06GqDLa_N9c",
            authDomain: "puffly-86e43.firebaseapp.com",
            projectId: "puffly-86e43",
            storageBucket: "puffly-86e43.firebasestorage.app",
            messagingSenderId: "841845436320",
            appId: "1:841845436320:web:61e2ff1988c48bc634fec5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const userRef = doc(db, "users", "default_user");

        let myCoins = 0;
        let myIncome = 0;

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Real-time ‡∏à‡∏≤‡∏Å Firebase
        onSnapshot(userRef, (snap) => {
            if(snap.exists()){
                myCoins = snap.data().coins;
                myIncome = snap.data().income;
                document.getElementById('userCoins').innerText = myCoins.toLocaleString();
                document.getElementById('userIncome').innerText = myIncome.toFixed(2);
            } else {
                setDoc(userRef, { coins: 1000, income: 0 });
            }
        });

        // --- 2. Functions ---
        window.switchTab = (viewId, el) => {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active-view'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(viewId).classList.add('active-view');
            el.classList.add('active');
        };

        window.toggleLike = () => {
            const btn = document.getElementById('likeBtn');
            const count = document.getElementById('likeCount');
            btn.classList.toggle('liked');
            count.innerText = btn.classList.contains('liked') ? "1" : "0";
        };

        window.sendMsg = () => {
            const inp = document.getElementById('msgInput');
            if(!inp.value) return;
            const b = document.createElement('div');
            b.className = "bubble me"; b.innerText = inp.value;
            document.getElementById('chatBox').appendChild(b);
            inp.value = "";
        };

        window.openLive = () => document.getElementById('liveOverlay').style.display = 'flex';
        window.closeLive = () => document.getElementById('liveOverlay').style.display = 'none';
        window.toggleGiftPanel = (e) => { e.stopPropagation(); document.getElementById('giftPanel').classList.toggle('active'); };

        window.sendGift = async (icon, cost, val) => {
            if(myCoins >= cost) {
                await updateDoc(userRef, { 
                    coins: myCoins - cost,
                    income: myIncome + val
                });
                const d = document.createElement('div');
                d.innerHTML = `üéÅ ‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á ${icon}`;
                document.getElementById('liveComments').appendChild(d);
            } else { alert("Coins ‡πÑ‡∏°‡πà‡∏û‡∏≠!"); }
        };

        window.withdrawMoney = async () => {
            if(myIncome <= 0) return;
            if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô?")) await updateDoc(userRef, { income: 0 });
        };

        // ‡∏õ‡∏¥‡∏î Splash
        setTimeout(() => {
            document.getElementById('splash').style.opacity = '0';
            setTimeout(() => document.getElementById('splash').style.display = 'none', 800);
        }, 2000);
    </script>
</body>
</html>
