<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Puffly | Full Sovereign Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff8fa3; --primary-grad: linear-gradient(135deg, #ffb3c1, #ff758f);
            --bg: #fff0f3; --card: #ffffff; --text: #4a2c32; --muted: #a38a8e;
            --accent: #ff4d6d; --bubble-me: #ffb3c1; --bubble-you: #ffe5ec;
            --nav-bg: rgba(255, 255, 255, 0.95);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* --- 1. Auth & Splash --- */
        #authView { position: fixed; inset: 0; background: white; z-index: 9000; display: flex; flex-direction: column; padding: 40px 25px; transition: 0.8s; }
        .btn-auth { border: none; padding: 16px; border-radius: 30px; font-weight: bold; font-size: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 12px; }
        .btn-line { background: #06C755; color: white; }
        .btn-main { background: var(--primary-grad); color: white; }
        #splash { position: fixed; inset: 0; background: var(--primary-grad); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; }

        /* --- 2. Layout & Nav --- */
        .view-section { flex: 1; display: none; overflow-y: auto; padding-bottom: 80px; }
        .active-view { display: block; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 75px; background: var(--nav-bg); backdrop-filter: blur(15px); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid rgba(0,0,0,0.05); z-index: 4000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 5px; color: var(--muted); cursor: pointer; font-size: 11px; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 24px; }

        /* --- 3. Reels & Actions --- */
        #homeView { background: #000; overflow: hidden; }
        .reel-video { position: relative; width: 100%; height: 100vh; display: flex; align-items: center; justify-content: center; color: white; }
        .reel-actions { position: absolute; bottom: 120px; right: 15px; display: flex; flex-direction: column; gap: 20px; align-items: center; text-align: center; }
        .action-btn { cursor: pointer; }
        .action-btn i { font-size: 30px; margin-bottom: 5px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .action-btn.active i { color: var(--primary); }

        /* --- 4. Chat & Sheets --- */
        .chat-container { padding: 15px; display: flex; flex-direction: column; gap: 12px; height: calc(100vh - 215px); overflow-y: auto; }
        .bubble { max-width: 80%; padding: 10px 15px; border-radius: 18px; font-size: 14px; }
        .bubble.me { align-self: flex-end; background: var(--primary-grad); color: white; border-bottom-right-radius: 4px; }
        .bubble.you { align-self: flex-start; background: white; border-bottom-left-radius: 4px; border: 1px solid #eee; }
        #commentSheet { display:none; position:fixed; bottom:0; left:0; right:0; height:65vh; background:white; z-index:4500; border-top-left-radius:25px; border-top-right-radius:25px; flex-direction:column; box-shadow: 0 -5px 20px rgba(0,0,0,0.2); }

        /* --- 5. Live & Gift --- */
        #liveOverlay { display: none; position: fixed; inset: 0; background: #000; z-index: 5000; flex-direction: column; }
        .gift-panel { position: absolute; bottom: -100%; left: 0; right: 0; background: white; border-top-left-radius: 25px; border-top-right-radius: 25px; padding: 20px; transition: 0.4s; z-index: 5001; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .gift-panel.active { bottom: 0; }
    </style>
</head>
<body onclick="hideGiftPanel(event)">
    <div id="authView">
        <div style="text-align: center; margin-top: 40px;">
            <i class="fa-solid fa-dove" style="font-size: 60px; color: var(--primary);"></i>
            <h1 style="margin-top: 20px; letter-spacing: 5px;">PUFFLY</h1>
        </div>
        <div style="margin-top: 60px;">
            <button class="btn-auth btn-line" onclick="handleAuth()"><i class="fa-brands fa-line"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ LINE</button>
            <input type="text" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" style="width:100%; padding: 16px; border-radius: 30px; border: 1px solid #eee; margin-bottom:12px; text-align:center; outline:none;">
            <button class="btn-auth btn-main" style="width:100%;" onclick="handleAuth()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>

    <div id="splash"><i class="fa-solid fa-dove" style="font-size:60px;"></i><h1>PUFFLY</h1></div>

    <div id="homeView" class="view-section">
        <div class="reel-video">
            <i class="fa-solid fa-play-circle" style="font-size: 80px; opacity: 0.1;"></i>
            <div style="position:absolute; bottom:100px; left:15px;">
                <h3>@Creator_Asura</h3>
                <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤! üïäÔ∏è‚ú®</p>
            </div>
            <div class="reel-actions">
                <div class="action-btn" onclick="openLive()"><i class="fa-solid fa-tower-broadcast" style="color:#ff4d6d;"></i><p>Live</p></div>
                <div class="action-btn" onclick="this.classList.toggle('active')"><i class="fa-solid fa-heart"></i><p>1.2K</p></div>
                <div class="action-btn" onclick="openComments()"><i class="fa-solid fa-comment-dots"></i><p>450</p></div>
                <div class="action-btn" onclick="this.classList.toggle('active')"><i class="fa-solid fa-bookmark"></i><p>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p></div>
                <div class="action-btn" onclick="shareContent()"><i class="fa-solid fa-share"></i><p>‡πÅ‡∏ä‡∏£‡πå</p></div>
            </div>
        </div>

        <div id="commentSheet">
            <div style="padding:15px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                <b>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</b><i class="fa-solid fa-xmark" onclick="closeComments()"></i>
            </div>
            <div id="reelsCommentBox" style="flex:1; overflow-y:auto; padding:15px;"></div>
            <div style="padding:15px; display:flex; gap:10px; border-top:1px solid #eee;">
                <input type="text" id="reelsInp" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå..." style="flex:1; border:none; outline:none;">
                <b style="color:var(--primary);" onclick="sendReelComment()">‡∏™‡πà‡∏á</b>
            </div>
        </div>
    </div>

    <div id="inboxView" class="view-section">
        <div class="chat-header">
            <div style="width:40px; height:40px; border-radius:12px; background:var(--primary-grad); display:flex; align-items:center; justify-content:center; color:white;"><i class="fa-solid fa-dove"></i></div>
            <div style="flex:1;"><b>Puffly Support</b><p style="font-size:10px; color:green;">Online</p></div>
        </div>
        <div id="chatBox" class="chat-container"></div>
        <div style="padding:15px; background:white; border-top:1px solid #eee;">
            <div style="display:flex; gap:10px; align-items:center;">
                <i class="fa-solid fa-face-smile" style="color:var(--primary); font-size:24px;" onclick="toggleSticker()"></i>
                <input type="text" id="msgInput" style="flex:1; background:#f8f8f8; border:none; padding:10px; border-radius:20px;" placeholder="‡∏Ñ‡∏∏‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß...">
                <i class="fa-solid fa-paper-plane" style="color:var(--primary);" onclick="sendMsg()"></i>
            </div>
            <div id="stickerPanel" style="display:none; grid-template-columns:repeat(4,1fr); gap:10px; padding-top:10px;">
                <span onclick="buySticker('üê±', 5)">üê± 5C</span>
                <span onclick="buySticker('‚òÅÔ∏è', 5)">‚òÅÔ∏è 5C</span>
                <span onclick="buySticker('üëë', 100)">üëë 100C</span>
                <span onclick="buySticker('üî•', 10)">üî• 10C</span>
            </div>
        </div>
    </div>
    <div id="profileView" class="view-section">
        <div class="profile-header">
            <div class="profile-pic" onclick="adminSecret()"><i class="fa-solid fa-user"></i></div>
            <h2>@Creator_Asura</h2>
            <p style="color:var(--muted); font-size:12px;">‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á Asura's Ransom <span onclick="window.location.href='admin.html'" style="font-size:5px; opacity:0.01;">.</span></p>
        </div>
        <div class="wallet-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div><p style="font-size:10px;">Coins ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</p><h2 id="userCoins">...</h2></div>
                <div><p style="font-size:10px;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ</p><h2>‡∏ø <span id="userIncome">0.00</span></h2></div>
                <button onclick="withdrawMoney()" style="background:white; color:var(--primary); border:none; padding:8px 15px; border-radius:12px; font-weight:bold; font-size:12px;">‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
        </div>
        
        <div style="padding:15px; background:white; margin:0 20px; border-radius:20px;">
            <p style="font-weight:bold; margin-bottom:10px; font-size:14px;">‡πÄ‡∏ï‡∏¥‡∏° Coins (Puffly Shop)</p>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div onclick="topUp(100, 35)" style="border:1px solid #eee; padding:15px; border-radius:15px; text-align:center; cursor:pointer;">
                    <span style="font-size:20px;">ü™ô 100</span><br><b style="color:var(--primary);">‡∏ø35</b>
                </div>
                <div onclick="topUp(500, 150)" style="border:1px solid #eee; padding:15px; border-radius:15px; text-align:center; cursor:pointer;">
                    <span style="font-size:20px;">ü™ô 500</span><br><b style="color:var(--primary);">‡∏ø150</b>
                </div>
            </div>
        </div>
    </div>

    <div id="liveOverlay">
        <div style="padding:20px; display:flex; justify-content:space-between; color:white; align-items:center;">
            <div style="background:red; padding:4px 12px; border-radius:6px; font-weight:bold; font-size:12px;">LIVE</div>
            <div style="background:rgba(0,0,0,0.4); padding:4px 12px; border-radius:20px;">ü™ô <span id="liveCoinsUI">0</span></div>
            <i class="fa-solid fa-xmark" onclick="closeLive()" style="font-size:28px;"></i>
        </div>
        <div id="liveComments" class="live-chat"></div>
        <div style="padding:15px 20px 30px; display:flex; gap:12px; align-items:center; background:linear-gradient(to top, rgba(0,0,0,0.6), transparent);">
            <input type="text" id="liveInp" style="flex:1; background:rgba(255,255,255,0.2); border:none; padding:14px; border-radius:25px; color:white; outline:none;" placeholder="‡∏Ñ‡∏∏‡∏¢‡πÉ‡∏ô‡πÑ‡∏•‡∏ü‡πå...">
            <i class="fa-solid fa-gift" style="color:#ffd700; font-size:32px;" onclick="toggleGiftPanel(event)"></i>
        </div>
        <div id="giftPanel" class="gift-panel" onclick="event.stopPropagation()">
            <div class="gift-item" onclick="sendGift('üéÄ', 10, 7)"><span>üéÄ</span><small>10 C</small></div>
            <div class="gift-item" onclick="sendGift('üß∏', 50, 35)"><span>üß∏</span><small>50 C</small></div>
            <div class="gift-item" onclick="sendGift('üëë', 500, 350)"><span>üëë</span><small>500 C</small></div>
            <div class="gift-item" onclick="sendGift('üïäÔ∏è', 1000, 700)"><span>üïäÔ∏è</span><small>1K C</small></div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('homeView', this)"><i class="fa-solid fa-house"></i><span>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span></div>
        <div class="nav-item" onclick="switchTab('inboxView', this)"><i class="fa-solid fa-comment-dots"></i><span>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span></div>
        <div class="nav-item" style="color:var(--primary);"><i class="fa-solid fa-circle-plus" style="font-size:35px;"></i></div>
        <div class="nav-item" onclick="alert('Search coming soon')"><i class="fa-solid fa-magnifying-glass"></i><span>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span></div>
        <div class="nav-item" onclick="switchTab('profileView', this)"><i class="fa-solid fa-user"></i><span>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span></div>
    </nav>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAT48SVlLZGo_XEYmf_K4MD06GqDLa_N9c",
            authDomain: "puffly-86e43.firebaseapp.com",
            projectId: "puffly-86e43",
            storageBucket: "puffly-86e43.firebasestorage.app",
            messagingSenderId: "841845436320",
            appId: "1:841845436320:web:61e2ff1988c48bc634fec5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const userRef = doc(db, "users", "default_user");

        let myCoins = 0, myIncome = 0;

        // --- 1. Auth & Initial ---
        window.handleAuth = () => {
            document.getElementById('authView').style.display = 'none';
            document.getElementById('splash').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('splash').style.display = 'none';
                document.getElementById('homeView').classList.add('active-view');
            }, 2000);
        };

        onSnapshot(userRef, (snap) => {
            if (snap.exists()) {
                myCoins = snap.data().coins; myIncome = snap.data().income;
                document.getElementById('userCoins').innerText = myCoins.toLocaleString();
                document.getElementById('liveCoinsUI').innerText = myCoins.toLocaleString();
                document.getElementById('userIncome').innerText = myIncome.toFixed(2);
            } else { setDoc(userRef, { coins: 100, income: 0 }); }
        });

        // --- 2. Navigation & Tabs ---
        window.switchTab = (id, el) => {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active-view'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active-view');
            el.classList.add('active');
        };

        // --- 3. Reel Features (Share & Save) ---
        window.openComments = () => document.getElementById('commentSheet').style.display = 'flex';
        window.closeComments = () => document.getElementById('commentSheet').style.display = 'none';
        
        window.sendReelComment = () => {
            const inp = document.getElementById('reelsInp');
            if(!inp.value) return;
            const div = document.createElement('div');
            div.innerHTML = `<p style="font-size:13px; margin-bottom:8px;"><b>‡∏Ñ‡∏∏‡∏ì:</b> ${inp.value}</p>`;
            document.getElementById('reelsCommentBox').appendChild(div);
            inp.value = '';
        };

        window.shareContent = () => {
            if (navigator.share) {
                navigator.share({ title: 'Puffly', text: '‡∏î‡∏π‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ô‡∏µ‡πâ‡∏ö‡∏ô Puffly ‡∏™‡∏¥!', url: window.location.href });
            } else { alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! (‡∏à‡∏≥‡∏•‡∏≠‡∏á)"); }
        };

        // --- 4. Chat & Stickers ---
        window.sendMsg = () => {
            const inp = document.getElementById('msgInput');
            if(!inp.value) return;
            const b = document.createElement('div'); b.className = 'bubble me'; b.innerText = inp.value;
            document.getElementById('chatBox').appendChild(b); inp.value = '';
        };

        window.toggleSticker = () => {
            const p = document.getElementById('stickerPanel');
            p.style.display = p.style.display === 'none' ? 'grid' : 'none';
        };

        window.buySticker = async (icon, cost) => {
            if(myCoins >= cost) {
                await updateDoc(userRef, { coins: myCoins - cost });
                const b = document.createElement('div'); b.className = 'bubble me'; b.style.background = 'none'; b.style.fontSize = '40px'; b.innerText = icon;
                document.getElementById('chatBox').appendChild(b);
                document.getElementById('stickerPanel').style.display = 'none';
            } else { alert("Coins ‡πÑ‡∏°‡πà‡∏û‡∏≠"); }
        };

        // --- 5. Live & Admin ---
        window.openLive = () => document.getElementById('liveOverlay').style.display = 'flex';
        window.closeLive = () => document.getElementById('liveOverlay').style.display = 'none';
        window.toggleGiftPanel = (e) => { e.stopPropagation(); document.getElementById('giftPanel').classList.toggle('active'); };
        window.hideGiftPanel = () => document.getElementById('giftPanel').classList.remove('active');

        window.sendGift = async (icon, cost, earn) => {
            if(myCoins >= cost) {
                await updateDoc(userRef, { coins: myCoins - cost, income: myIncome + earn });
                const d = document.createElement('div'); d.innerHTML = `<b style="color:#ffd700;">üéÅ ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç:</b> ‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á ${icon}`;
                document.getElementById('liveComments').appendChild(d);
                hideGiftPanel();
            } else { alert("Coins ‡πÑ‡∏°‡πà‡∏û‡∏≠"); }
        };

        let clicks = 0;
        window.adminSecret = () => {
            clicks++;
            if(clicks >= 3) { window.location.href = 'admin.html'; clicks = 0; }
            setTimeout(() => clicks = 0, 2000);
        };

        window.topUp = async (c, p) => { if(confirm(`‡πÄ‡∏ï‡∏¥‡∏° ${c} Coins?`)) await updateDoc(userRef, { coins: myCoins + c }); };
        window.withdrawMoney = async () => { if(myIncome > 0) { await updateDoc(userRef, { income: 0 }); alert("‡∏ñ‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); } };
    </script>
</body>
</html>
